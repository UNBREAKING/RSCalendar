'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LookupCandidateList = exports.LookupSearch = exports.LookupSelection = undefined;

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _getIterator2 = require('babel-runtime/core-js/get-iterator');

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _assign = require('babel-runtime/core-js/object/assign');

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

var _FormElement = require('./FormElement');

var _FormElement2 = _interopRequireDefault(_FormElement);

var _Input = require('./Input');

var _Input2 = _interopRequireDefault(_Input);

var _Icon = require('./Icon');

var _Icon2 = _interopRequireDefault(_Icon);

var _Spinner = require('./Spinner');

var _Spinner2 = _interopRequireDefault(_Spinner);

var _Pill = require('./Pill');

var _Pill2 = _interopRequireDefault(_Pill);

var _DropdownButton = require('./DropdownButton');

var _DropdownButton2 = _interopRequireDefault(_DropdownButton);

var _DropdownMenu = require('./DropdownMenu');

var _util = require('./util');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var LookupSelection = exports.LookupSelection = function (_Component) {
  (0, _inherits3.default)(LookupSelection, _Component);

  function LookupSelection() {
    (0, _classCallCheck3.default)(this, LookupSelection);
    return (0, _possibleConstructorReturn3.default)(this, (LookupSelection.__proto__ || (0, _getPrototypeOf2.default)(LookupSelection)).apply(this, arguments));
  }

  (0, _createClass3.default)(LookupSelection, [{
    key: 'onKeyDown',
    value: function onKeyDown(e) {
      if (e.keyCode === 8 || e.keyCode === 46) {
        // Bacspace / DEL
        e.preventDefault();
        e.stopPropagation();
        if (this.props.onResetSelection) {
          this.props.onResetSelection();
        }
      }
    }
  }, {
    key: 'renderPill',
    value: function renderPill(selected) {
      var _this2 = this;

      var onPillClick = function onPillClick(e) {
        e.target.focus();
        e.preventDefault();
        e.stopPropagation();
      };
      return _react2.default.createElement(_Pill2.default, {
        id: this.props.id,
        truncate: true,
        pillRef: function pillRef(node) {
          return _this2.pill = node;
        },
        onKeyDown: this.onKeyDown.bind(this),
        onClick: onPillClick,
        tabIndex: 0,
        icon: selected.icon ? {
          category: selected.category,
          icon: selected.icon
        } : undefined,
        label: selected.label,
        onRemove: this.props.onResetSelection
      });
    }
  }, {
    key: 'render',
    value: function render() {
      var _props = this.props,
          hidden = _props.hidden,
          selected = _props.selected,
          lookupSelectionRef = _props.lookupSelectionRef;

      var lookupClassNames = (0, _classnames2.default)({ 'slds-hide': hidden });
      return _react2.default.createElement(
        'div',
        { ref: lookupSelectionRef, className: lookupClassNames },
        _react2.default.createElement(
          'div',
          { className: 'slds-pill__container' },
          selected ? this.renderPill(selected) : undefined
        )
      );
    }
  }]);
  return LookupSelection;
}(_react.Component);

var LookupEntryType = _react.PropTypes.shape({
  category: _react.PropTypes.string,
  icon: _react.PropTypes.string,
  label: _react.PropTypes.string,
  value: _react.PropTypes.string
});

LookupSelection.propTypes = {
  id: _react.PropTypes.string,
  selected: LookupEntryType,
  hidden: _react.PropTypes.bool,
  onResetSelection: _react.PropTypes.func,
  lookupSelectionRef: _react.PropTypes.func
};

/**
 *
 */

var LookupSearch = exports.LookupSearch = function (_Component2) {
  (0, _inherits3.default)(LookupSearch, _Component2);

  function LookupSearch(props) {
    (0, _classCallCheck3.default)(this, LookupSearch);

    /* eslint-disable max-len */
    var _this3 = (0, _possibleConstructorReturn3.default)(this, (LookupSearch.__proto__ || (0, _getPrototypeOf2.default)(LookupSearch)).call(this, props));

    _this3.onLookupIconClick = function () {
      _this3.props.onSubmit();
    };

    _this3.onInputKeyDown = function (e) {
      if (e.keyCode === 13) {
        // return key
        e.preventDefault();
        e.stopPropagation();
        var searchText = e.target.value;
        if (searchText) {
          _this3.props.onSubmit();
        } else {
          // if no search text, quit lookup search
          _this3.props.onComplete();
        }
      } else if (e.keyCode === 40) {
        // down key
        e.preventDefault();
        e.stopPropagation();
        _this3.props.onPressDown();
      } else if (e.keyCode === 27) {
        // ESC
        e.preventDefault();
        e.stopPropagation();
        // quit lookup search (cancel)
        var cancel = true;
        _this3.props.onComplete(cancel);
      }
      if (_this3.props.onKeyDown) {
        _this3.props.onKeyDown(e);
      }
    };

    _this3.onInputChange = function (e) {
      var searchText = e.target.value;
      _this3.props.onChange(searchText);
    };

    _this3.onInputBlur = function (e) {
      setTimeout(function () {
        if (!_this3.isFocusedInComponent()) {
          if (_this3.props.onBlur) {
            _this3.props.onBlur(e);
          }
        }
      }, 10);
    };

    _this3.onScopeMenuClick = function (e) {
      if (_this3.props.onScopeMenuClick) {
        _this3.props.onScopeMenuClick(e);
      }
    };

    _this3.onMenuItemClick = function (scope) {
      if (_this3.props.onScopeChange) {
        _this3.props.onScopeChange(scope.value);
      }
    };

    _this3.handleLookupSearchRef = function (node) {
      _this3.node = node;
      var lookupSearchRef = _this3.props.lookupSearchRef;

      if (lookupSearchRef) {
        lookupSearchRef(node);
      }
    };

    (0, _util.registerStyle)('lookupSearch', [['.slds-lookup[data-scope="multi"] .react-slds-lookup-scope-selector', '{ min-width: 3rem; }'], ['.slds-lookup[data-scope="multi"] .react-slds-lookup-scope-selector .slds-dropdown-trigger', '{ margin-left: 0; }'], ['.slds-lookup[data-scope="multi"] .react-slds-lookup-scope-selector .slds-dropdown-trigger .slds-button', '{ padding: 0 0.25rem; }'], ['.slds-lookup[data-scope="multi"] .slds-box--border', '{ background-color: white; }'], ['.slds-lookup[data-scope="multi"] .slds-box--border.react-slds-box-disabled', '{ background-color: #e0e5ee; border-color: #a8b7c7; cursor: not-allowed; }'], ['.slds-lookup[data-scope="multi"] .slds-box--border .slds-input--bare', '{ height: 2.15rem; width: 100%; }']]);
    return _this3;
  }

  (0, _createClass3.default)(LookupSearch, [{
    key: 'isFocusedInComponent',
    value: function isFocusedInComponent() {
      return (0, _util.isElInChildren)(this.node, document.activeElement);
    }
  }, {
    key: 'renderSearchInput',
    value: function renderSearchInput(props) {
      var _this4 = this;

      var className = props.className,
          hidden = props.hidden,
          searchText = props.searchText,
          _props$iconAlign = props.iconAlign,
          iconAlign = _props$iconAlign === undefined ? 'right' : _props$iconAlign;

      var searchInputClassNames = (0, _classnames2.default)('slds-grid', 'slds-input-has-icon', 'slds-input-has-icon--' + iconAlign, { 'slds-hide': hidden }, className);
      var pprops = (0, _assign2.default)({}, props);
      delete pprops.iconAlign;
      delete pprops.searchText;
      delete pprops.targetScope;
      delete pprops.onScopeMenuClick;
      delete pprops.onScopeChange;
      delete pprops.onPressDown;
      delete pprops.onComplete;
      delete pprops.defaultTargetScope;
      delete pprops.onSearchTextChange;
      delete pprops.scopes;
      delete pprops.onLookupRequest;
      delete pprops.defaultSearchText;
      delete pprops.onValueChange;
      delete pprops.lookupSearchRef;
      return _react2.default.createElement(
        'div',
        { ref: this.handleLookupSearchRef, className: searchInputClassNames },
        _react2.default.createElement(_Input2.default, (0, _extends3.default)({}, pprops, {
          inputRef: function inputRef(node) {
            return _this4.input = node;
          },
          value: searchText,
          onKeyDown: this.onInputKeyDown,
          onChange: this.onInputChange,
          onBlur: this.onInputBlur
        })),
        _react2.default.createElement(
          'span',
          {
            tabIndex: -1,
            style: props.disabled ? undefined : { cursor: 'pointer' },
            onClick: props.disabled ? undefined : this.onLookupIconClick
          },
          _react2.default.createElement(_Icon2.default, {
            icon: 'search',
            className: 'slds-input__icon'
          })
        )
      );
    }
  }, {
    key: 'renderScopeSelector',
    value: function renderScopeSelector(_ref) {
      var scopes = _ref.scopes,
          target = _ref.targetScope,
          disabled = _ref.disabled;

      var targetScope = scopes[0] || {};
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = (0, _getIterator3.default)(scopes), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var scope = _step.value;

          if (scope.value === target) {
            targetScope = scope;
            break;
          }
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      var icon = _react2.default.createElement(_Icon2.default, { icon: targetScope.icon || 'none', size: 'x-small' });
      var selectorClassNames = (0, _classnames2.default)('slds-grid', 'slds-grid--align-center', 'slds-grid--vertical-align-center', 'react-slds-lookup-scope-selector');
      return _react2.default.createElement(
        'div',
        { className: selectorClassNames },
        _react2.default.createElement(
          _DropdownButton2.default,
          {
            label: icon,
            disabled: disabled,
            onClick: this.onScopeMenuClick,
            onMenuItemClick: this.onMenuItemClick,
            onBlur: this.onInputBlur
          },
          scopes.map(function (scope) {
            return _react2.default.createElement(_DropdownMenu.DropdownMenuItem, (0, _extends3.default)({ key: scope.value }, scope));
          })
        )
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var _props2 = this.props,
          scopes = _props2.scopes,
          hidden = _props2.hidden,
          disabled = _props2.disabled,
          targetScope = _props2.targetScope,
          props = (0, _objectWithoutProperties3.default)(_props2, ['scopes', 'hidden', 'disabled', 'targetScope']);

      if (scopes) {
        var lookupSearchClassNames = (0, _classnames2.default)('slds-grid', 'slds-form-element__control', 'slds-box--border', { 'react-slds-box-disabled': disabled }, { 'slds-hide': hidden });
        var styles = { WebkitFlexWrap: 'nowrap', msFlexWrap: 'nowrap', flexWrap: 'nowrap' };
        return _react2.default.createElement(
          'div',
          { ref: this.handleLookupSearchRef, className: lookupSearchClassNames, style: styles },
          this.renderScopeSelector({ scopes: scopes, targetScope: targetScope, disabled: disabled }),
          this.renderSearchInput((0, _extends3.default)({}, props, { disabled: disabled, className: 'slds-col', bare: true }))
        );
      }
      return this.renderSearchInput(this.props);
    }
  }]);
  return LookupSearch;
}(_react.Component);

var ICON_ALIGNS = ['left', 'right'];

LookupSearch.propTypes = {
  className: _react.PropTypes.string,
  hidden: _react.PropTypes.bool,
  searchText: _react.PropTypes.string,
  scopes: _react.PropTypes.arrayOf(_react.PropTypes.shape({
    label: _react.PropTypes.string,
    value: _react.PropTypes.string,
    icon: _react.PropTypes.string
  })),
  targetScope: _react.PropTypes.any, // eslint-disable-line
  iconAlign: _react.PropTypes.oneOf(ICON_ALIGNS),
  disabled: _react.PropTypes.bool,
  onKeyDown: _react.PropTypes.func,
  onBlur: _react.PropTypes.func,
  onChange: _react.PropTypes.func,
  onScopeMenuClick: _react.PropTypes.func,
  onScopeChange: _react.PropTypes.func,
  onPressDown: _react.PropTypes.func,
  onSubmit: _react.PropTypes.func,
  onComplete: _react.PropTypes.func,
  lookupSearchRef: _react.PropTypes.func
};

/**
 *
 */

var LookupCandidateList = exports.LookupCandidateList = function (_Component3) {
  (0, _inherits3.default)(LookupCandidateList, _Component3);

  function LookupCandidateList() {
    (0, _classCallCheck3.default)(this, LookupCandidateList);
    return (0, _possibleConstructorReturn3.default)(this, (LookupCandidateList.__proto__ || (0, _getPrototypeOf2.default)(LookupCandidateList)).apply(this, arguments));
  }

  (0, _createClass3.default)(LookupCandidateList, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      if (this.props.focus) {
        this.focusToTargetItemEl(0);
      }
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate(prevProps) {
      if (this.props.focus && !prevProps.focus) {
        this.focusToTargetItemEl(0);
      }
    }
  }, {
    key: 'onSelect',
    value: function onSelect(entry) {
      if (this.props.onSelect) {
        this.props.onSelect(entry);
      }
    }
  }, {
    key: 'onKeyDown',
    value: function onKeyDown(e) {
      if (e.keyCode === 38 || e.keyCode === 40) {
        // UP/DOWN
        e.preventDefault();
        e.stopPropagation();
        var currentEl = e.target.parentElement;
        var itemEl = e.keyCode === 40 ? currentEl.nextSibling : currentEl.previousSibling;
        while (itemEl) {
          var anchorEl = itemEl.querySelector('.react-slds-candidate[tabIndex]');
          if (anchorEl && !anchorEl.disabled) {
            anchorEl.focus();
            return;
          }
          itemEl = e.keyCode === 40 ? itemEl.nextSibling : itemEl.previousSibling;
        }
      } else if (e.keyCode === 27) {
        // ESC
        e.preventDefault();
        e.stopPropagation();
        this.onSelect(null);
      }
    }
  }, {
    key: 'focusToTargetItemEl',
    value: function focusToTargetItemEl(index) {
      var el = this.node;
      var anchors = el.querySelectorAll('.react-slds-candidate[tabIndex]');
      if (anchors[index]) {
        anchors[index].focus();
      }
    }
  }, {
    key: 'renderCandidate',
    value: function renderCandidate(entry) {
      var _this6 = this;

      return _react2.default.createElement(
        'li',
        { className: 'slds-lookup__item', key: entry.value },
        _react2.default.createElement(
          'a',
          {
            className: 'slds-truncate react-slds-candidate',
            tabIndex: -1,
            role: 'option',
            onKeyDown: function onKeyDown(e) {
              return e.keyCode === 13 && _this6.onSelect(entry);
            },
            onBlur: this.props.onBlur,
            onClick: function onClick() {
              return _this6.onSelect(entry);
            }
          },
          entry.icon ? _react2.default.createElement(_Icon2.default, {
            category: entry.category,
            icon: entry.icon,
            size: 'small'
          }) : undefined,
          entry.label
        )
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var _this7 = this;

      var _props3 = this.props,
          _props3$data = _props3.data,
          data = _props3$data === undefined ? [] : _props3$data,
          hidden = _props3.hidden,
          loading = _props3.loading,
          header = _props3.header,
          footer = _props3.footer,
          _props3$filter = _props3.filter,
          filter = _props3$filter === undefined ? function () {
        return true;
      } : _props3$filter;

      var lookupMenuClassNames = (0, _classnames2.default)('slds-lookup__menu', { 'slds-hide': hidden, 'slds-show': !hidden });
      return _react2.default.createElement(
        'div',
        {
          ref: function ref(node) {
            return _this7.node = node;
          },
          className: lookupMenuClassNames,
          role: 'listbox',
          onKeyDown: this.onKeyDown.bind(this)
        },
        header ? _react2.default.createElement(
          'div',
          { className: 'slds-lookup__item' },
          header
        ) : undefined,
        _react2.default.createElement(
          'ul',
          { className: 'slds-lookup__list', role: 'presentation' },
          data.filter(filter).map(this.renderCandidate.bind(this)),
          loading ? _react2.default.createElement(
            'li',
            { className: 'slds-lookup__item', key: 'loading', style: { height: 20 } },
            _react2.default.createElement(_Spinner2.default, { container: false, size: 'small', style: { margin: '0 auto' } })
          ) : undefined
        ),
        footer ? _react2.default.createElement(
          'div',
          { className: 'slds-lookup__item' },
          footer
        ) : undefined
      );
    }
  }]);
  return LookupCandidateList;
}(_react.Component);

LookupCandidateList.propTypes = {
  data: _react.PropTypes.arrayOf(LookupEntryType),
  focus: _react.PropTypes.bool,
  loading: _react.PropTypes.bool,
  hidden: _react.PropTypes.bool,
  filter: _react.PropTypes.func,
  onSelect: _react.PropTypes.func,
  onBlur: _react.PropTypes.func,
  header: _react.PropTypes.node,
  footer: _react.PropTypes.node
};

/**
 *
 */

var Lookup = function (_Component4) {
  (0, _inherits3.default)(Lookup, _Component4);

  function Lookup(props) {
    (0, _classCallCheck3.default)(this, Lookup);

    var _this8 = (0, _possibleConstructorReturn3.default)(this, (Lookup.__proto__ || (0, _getPrototypeOf2.default)(Lookup)).call(this, props));

    _this8.state = {
      id: 'form-element-' + (0, _util.uuid)(),
      selected: props.defaultSelected,
      opened: props.defaultOpened,
      searchText: props.defaultSearchText,
      targetScope: props.defaultTargetScope,
      focusFirstCandidate: false
    };
    return _this8;
  }

  (0, _createClass3.default)(Lookup, [{
    key: 'onScopeMenuClick',
    value: function onScopeMenuClick(e) {
      this.setState({ opened: false });
      if (this.props.onScopeMenuClick) {
        this.props.onScopeMenuClick(e);
      }
    }
  }, {
    key: 'onScopeChange',
    value: function onScopeChange(targetScope) {
      this.setState({ targetScope: targetScope });
      if (this.props.onScopeChange) {
        this.props.onScopeChange(targetScope);
      }
    }
  }, {
    key: 'onSearchTextChange',
    value: function onSearchTextChange(searchText) {
      this.setState({ searchText: searchText });
      if (this.props.onSearchTextChange) {
        this.props.onSearchTextChange(searchText);
      }
    }
  }, {
    key: 'onLookupRequest',
    value: function onLookupRequest(searchText) {
      this.setState({ opened: true });
      if (this.props.onLookupRequest) {
        this.props.onLookupRequest(searchText);
      }
    }
  }, {
    key: 'onResetSelection',
    value: function onResetSelection() {
      var _this9 = this;

      this.setState({ selected: null });
      if (this.props.onSelect) {
        this.props.onSelect(null);
      }
      this.onSearchTextChange('');
      this.onLookupRequest('');
      setTimeout(function () {
        var searchElem = _this9.search;
        var inputElem = searchElem.querySelector('input');
        inputElem.focus();
      }, 10);
    }
  }, {
    key: 'onLookupItemSelect',
    value: function onLookupItemSelect(selected) {
      var _this10 = this;

      if (selected) {
        this.setState({ selected: selected, opened: false });
        if (this.props.onSelect) {
          this.props.onSelect(selected);
        }
        setTimeout(function () {
          var selectionElem = _this10.selection;
          var pillElem = selectionElem.querySelector('a');
          if (pillElem) {
            pillElem.focus();
          }
        }, 10);
      } else {
        this.setState({ opened: false });
        setTimeout(function () {
          var searchElem = _this10.search;
          var inputElem = searchElem.querySelector('input');
          inputElem.focus();
        }, 10);
      }
      if (this.props.onComplete) {
        this.props.onComplete(); // tell the component container to quit lookup
      }
    }
  }, {
    key: 'onFocusFirstCandidate',
    value: function onFocusFirstCandidate() {
      var _this11 = this;

      var _props$opened = this.props.opened,
          opened = _props$opened === undefined ? this.state.opened : _props$opened;

      if (!opened) {
        this.onLookupRequest(this.state.searchText);
      } else {
        this.setState({ focusFirstCandidate: true });
        setTimeout(function () {
          _this11.setState({ focusFirstCandidate: false });
        }, 10);
      }
    }
  }, {
    key: 'onBlur',
    value: function onBlur() {
      var _this12 = this;

      setTimeout(function () {
        if (!_this12.isFocusedInComponent()) {
          _this12.setState({ opened: false });
          if (_this12.props.onBlur) {
            _this12.props.onBlur();
          }
          if (_this12.props.onComplete) {
            _this12.props.onComplete(true); // quit lookup (cancel)
          }
        }
      }, 10);
    }
  }, {
    key: 'isFocusedInComponent',
    value: function isFocusedInComponent() {
      var rootEl = this.node;
      var targetEl = document.activeElement;
      while (targetEl && targetEl !== rootEl) {
        targetEl = targetEl.parentNode;
      }
      return !!targetEl;
    }
  }, {
    key: 'render',
    value: function render() {
      var _this13 = this;

      var id = this.props.id || this.state.id;
      var _props4 = this.props,
          totalCols = _props4.totalCols,
          cols = _props4.cols,
          label = _props4.label,
          required = _props4.required,
          error = _props4.error,
          className = _props4.className,
          _props4$selected = _props4.selected,
          selected = _props4$selected === undefined ? this.state.selected : _props4$selected,
          _props4$opened = _props4.opened,
          opened = _props4$opened === undefined ? this.state.opened : _props4$opened,
          _props4$searchText = _props4.searchText,
          searchText = _props4$searchText === undefined ? this.state.searchText : _props4$searchText,
          _props4$targetScope = _props4.targetScope,
          targetScope = _props4$targetScope === undefined ? this.state.targetScope : _props4$targetScope,
          loading = _props4.loading,
          lookupFilter = _props4.lookupFilter,
          listHeader = _props4.listHeader,
          listFooter = _props4.listFooter,
          data = _props4.data,
          onComplete = _props4.onComplete,
          props = (0, _objectWithoutProperties3.default)(_props4, ['totalCols', 'cols', 'label', 'required', 'error', 'className', 'selected', 'opened', 'searchText', 'targetScope', 'loading', 'lookupFilter', 'listHeader', 'listFooter', 'data', 'onComplete']);

      var dropdown = _react2.default.createElement(LookupCandidateList, {
        ref: function ref(node) {
          return _this13.candidateList = node;
        },
        data: data,
        focus: this.state.focusFirstCandidate,
        hidden: !opened,
        loading: loading,
        filter: lookupFilter ? function (entry) {
          return lookupFilter(entry, searchText, targetScope);
        } : undefined,
        header: listHeader,
        footer: listFooter,
        onSelect: this.onLookupItemSelect.bind(this),
        onBlur: this.onBlur.bind(this)
      });
      var lookupClassNames = (0, _classnames2.default)('slds-lookup', { 'slds-has-selection': selected }, className);
      var formElemProps = { id: id, totalCols: totalCols, cols: cols, label: label, required: required, error: error, dropdown: dropdown };
      /* eslint-disable no-unused-vars */
      var defaultSelected = props.defaultSelected,
          defaultOpened = props.defaultOpened,
          defaultSearchText = props.defaultSearchText,
          defaultTargetScope = props.defaultTargetScope,
          onSelect = props.onSelect,
          onBlur = props.onBlur,
          onScopeChange = props.onScopeChange,
          onScopeMenuClick = props.onScopeMenuClick,
          onSearchTextChange = props.onSearchTextChange,
          onLookupRequest = props.onLookupRequest,
          searchProps = (0, _objectWithoutProperties3.default)(props, ['defaultSelected', 'defaultOpened', 'defaultSearchText', 'defaultTargetScope', 'onSelect', 'onBlur', 'onScopeChange', 'onScopeMenuClick', 'onSearchTextChange', 'onLookupRequest']);
      /* eslint-enable no-unused-vars */

      return _react2.default.createElement(
        _FormElement2.default,
        (0, _extends3.default)({ formElementRef: function formElementRef(node) {
            return _this13.node = node;
          } }, formElemProps),
        _react2.default.createElement(
          'div',
          {
            className: lookupClassNames,
            'data-select': 'single',
            'data-scope': props.scopes ? 'multi' : 'single',
            'data-typeahead': false
          },
          selected ? _react2.default.createElement(LookupSelection, {
            id: id,
            lookupSelectionRef: function lookupSelectionRef(node) {
              return _this13.selection = node;
            },
            selected: selected,
            onResetSelection: this.onResetSelection.bind(this)
          }) : _react2.default.createElement(LookupSearch, (0, _extends3.default)({}, searchProps, {
            id: id,
            lookupSearchRef: function lookupSearchRef(node) {
              return _this13.search = node;
            },
            searchText: searchText,
            targetScope: targetScope,
            onScopeMenuClick: this.onScopeMenuClick.bind(this),
            onScopeChange: this.onScopeChange.bind(this),
            onChange: this.onSearchTextChange.bind(this),
            onSubmit: function onSubmit() {
              return _this13.onLookupRequest(searchText);
            },
            onPressDown: this.onFocusFirstCandidate.bind(this),
            onComplete: onComplete,
            onBlur: this.onBlur.bind(this)
          }))
        )
      );
    }
  }]);
  return Lookup;
}(_react.Component);

exports.default = Lookup;


Lookup.propTypes = {
  id: _react.PropTypes.string,
  className: _react.PropTypes.string,
  label: _react.PropTypes.string,
  required: _react.PropTypes.bool,
  error: _FormElement2.default.propTypes.error,
  value: _react.PropTypes.string,
  defaultValue: _react.PropTypes.string,
  selected: LookupEntryType,
  defaultSelected: LookupEntryType,
  opened: _react.PropTypes.bool,
  defaultOpened: _react.PropTypes.bool,
  searchText: _react.PropTypes.string,
  defaultSearchText: _react.PropTypes.string,
  loading: _react.PropTypes.bool,
  data: _react.PropTypes.arrayOf(LookupEntryType),
  lookupFilter: _react.PropTypes.func,
  listHeader: _react.PropTypes.node,
  listFooter: _react.PropTypes.node,
  scopes: _react.PropTypes.arrayOf(_react.PropTypes.shape({
    label: _react.PropTypes.string,
    value: _react.PropTypes.string,
    icon: _react.PropTypes.string
  })),
  targetScope: _react.PropTypes.string,
  iconAlign: _react.PropTypes.oneOf(ICON_ALIGNS),
  defaultTargetScope: _react.PropTypes.string,
  onSearchTextChange: _react.PropTypes.func,
  onScopeMenuClick: _react.PropTypes.func,
  onScopeChange: _react.PropTypes.func,
  onLookupRequest: _react.PropTypes.func,
  onBlur: _react.PropTypes.func,
  onSelect: _react.PropTypes.func,
  onComplete: _react.PropTypes.func,
  totalCols: _react.PropTypes.number,
  cols: _react.PropTypes.number
};

Lookup.isFormElement = true;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL0xvb2t1cC5qcyJdLCJuYW1lcyI6WyJMb29rdXBTZWxlY3Rpb24iLCJlIiwia2V5Q29kZSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwicHJvcHMiLCJvblJlc2V0U2VsZWN0aW9uIiwic2VsZWN0ZWQiLCJvblBpbGxDbGljayIsInRhcmdldCIsImZvY3VzIiwiaWQiLCJwaWxsIiwibm9kZSIsIm9uS2V5RG93biIsImJpbmQiLCJpY29uIiwiY2F0ZWdvcnkiLCJ1bmRlZmluZWQiLCJsYWJlbCIsImhpZGRlbiIsImxvb2t1cFNlbGVjdGlvblJlZiIsImxvb2t1cENsYXNzTmFtZXMiLCJyZW5kZXJQaWxsIiwiTG9va3VwRW50cnlUeXBlIiwic2hhcGUiLCJzdHJpbmciLCJ2YWx1ZSIsInByb3BUeXBlcyIsImJvb2wiLCJmdW5jIiwiTG9va3VwU2VhcmNoIiwib25Mb29rdXBJY29uQ2xpY2siLCJvblN1Ym1pdCIsIm9uSW5wdXRLZXlEb3duIiwic2VhcmNoVGV4dCIsIm9uQ29tcGxldGUiLCJvblByZXNzRG93biIsImNhbmNlbCIsIm9uSW5wdXRDaGFuZ2UiLCJvbkNoYW5nZSIsIm9uSW5wdXRCbHVyIiwic2V0VGltZW91dCIsImlzRm9jdXNlZEluQ29tcG9uZW50Iiwib25CbHVyIiwib25TY29wZU1lbnVDbGljayIsIm9uTWVudUl0ZW1DbGljayIsInNjb3BlIiwib25TY29wZUNoYW5nZSIsImhhbmRsZUxvb2t1cFNlYXJjaFJlZiIsImxvb2t1cFNlYXJjaFJlZiIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsImNsYXNzTmFtZSIsImljb25BbGlnbiIsInNlYXJjaElucHV0Q2xhc3NOYW1lcyIsInBwcm9wcyIsInRhcmdldFNjb3BlIiwiZGVmYXVsdFRhcmdldFNjb3BlIiwib25TZWFyY2hUZXh0Q2hhbmdlIiwic2NvcGVzIiwib25Mb29rdXBSZXF1ZXN0IiwiZGVmYXVsdFNlYXJjaFRleHQiLCJvblZhbHVlQ2hhbmdlIiwiaW5wdXQiLCJkaXNhYmxlZCIsImN1cnNvciIsInNlbGVjdG9yQ2xhc3NOYW1lcyIsIm1hcCIsImxvb2t1cFNlYXJjaENsYXNzTmFtZXMiLCJzdHlsZXMiLCJXZWJraXRGbGV4V3JhcCIsIm1zRmxleFdyYXAiLCJmbGV4V3JhcCIsInJlbmRlclNjb3BlU2VsZWN0b3IiLCJyZW5kZXJTZWFyY2hJbnB1dCIsImJhcmUiLCJJQ09OX0FMSUdOUyIsImFycmF5T2YiLCJhbnkiLCJvbmVPZiIsIkxvb2t1cENhbmRpZGF0ZUxpc3QiLCJmb2N1c1RvVGFyZ2V0SXRlbUVsIiwicHJldlByb3BzIiwiZW50cnkiLCJvblNlbGVjdCIsImN1cnJlbnRFbCIsInBhcmVudEVsZW1lbnQiLCJpdGVtRWwiLCJuZXh0U2libGluZyIsInByZXZpb3VzU2libGluZyIsImFuY2hvckVsIiwicXVlcnlTZWxlY3RvciIsImluZGV4IiwiZWwiLCJhbmNob3JzIiwicXVlcnlTZWxlY3RvckFsbCIsImRhdGEiLCJsb2FkaW5nIiwiaGVhZGVyIiwiZm9vdGVyIiwiZmlsdGVyIiwibG9va3VwTWVudUNsYXNzTmFtZXMiLCJyZW5kZXJDYW5kaWRhdGUiLCJoZWlnaHQiLCJtYXJnaW4iLCJMb29rdXAiLCJzdGF0ZSIsImRlZmF1bHRTZWxlY3RlZCIsIm9wZW5lZCIsImRlZmF1bHRPcGVuZWQiLCJmb2N1c0ZpcnN0Q2FuZGlkYXRlIiwic2V0U3RhdGUiLCJzZWFyY2hFbGVtIiwic2VhcmNoIiwiaW5wdXRFbGVtIiwic2VsZWN0aW9uRWxlbSIsInNlbGVjdGlvbiIsInBpbGxFbGVtIiwicm9vdEVsIiwidGFyZ2V0RWwiLCJwYXJlbnROb2RlIiwidG90YWxDb2xzIiwiY29scyIsInJlcXVpcmVkIiwiZXJyb3IiLCJsb29rdXBGaWx0ZXIiLCJsaXN0SGVhZGVyIiwibGlzdEZvb3RlciIsImRyb3Bkb3duIiwiY2FuZGlkYXRlTGlzdCIsIm9uTG9va3VwSXRlbVNlbGVjdCIsImZvcm1FbGVtUHJvcHMiLCJzZWFyY2hQcm9wcyIsIm9uRm9jdXNGaXJzdENhbmRpZGF0ZSIsImRlZmF1bHRWYWx1ZSIsIm51bWJlciIsImlzRm9ybUVsZW1lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7O0FBQ0E7Ozs7SUFFYUEsZSxXQUFBQSxlOzs7Ozs7Ozs7OzhCQUNEQyxDLEVBQUc7QUFDWCxVQUFJQSxFQUFFQyxPQUFGLEtBQWMsQ0FBZCxJQUFtQkQsRUFBRUMsT0FBRixLQUFjLEVBQXJDLEVBQXlDO0FBQUU7QUFDekNELFVBQUVFLGNBQUY7QUFDQUYsVUFBRUcsZUFBRjtBQUNBLFlBQUksS0FBS0MsS0FBTCxDQUFXQyxnQkFBZixFQUFpQztBQUMvQixlQUFLRCxLQUFMLENBQVdDLGdCQUFYO0FBQ0Q7QUFDRjtBQUNGOzs7K0JBRVVDLFEsRUFBVTtBQUFBOztBQUNuQixVQUFNQyxjQUFjLFNBQWRBLFdBQWMsQ0FBQ1AsQ0FBRCxFQUFPO0FBQ3pCQSxVQUFFUSxNQUFGLENBQVNDLEtBQVQ7QUFDQVQsVUFBRUUsY0FBRjtBQUNBRixVQUFFRyxlQUFGO0FBQ0QsT0FKRDtBQUtBLGFBQ0U7QUFDRSxZQUFLLEtBQUtDLEtBQUwsQ0FBV00sRUFEbEI7QUFFRSxzQkFGRjtBQUdFLGlCQUFVO0FBQUEsaUJBQVMsT0FBS0MsSUFBTCxHQUFZQyxJQUFyQjtBQUFBLFNBSFo7QUFJRSxtQkFBWSxLQUFLQyxTQUFMLENBQWVDLElBQWYsQ0FBb0IsSUFBcEIsQ0FKZDtBQUtFLGlCQUFVUCxXQUxaO0FBTUUsa0JBQVcsQ0FOYjtBQU9FLGNBQU1ELFNBQVNTLElBQVQsR0FBZ0I7QUFDcEJDLG9CQUFVVixTQUFTVSxRQURDO0FBRXBCRCxnQkFBTVQsU0FBU1M7QUFGSyxTQUFoQixHQUdGRSxTQVZOO0FBV0UsZUFBUVgsU0FBU1ksS0FYbkI7QUFZRSxrQkFBVyxLQUFLZCxLQUFMLENB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OUIsT0FBTytCLGFBQVAsR0FBdUIsSUFBdkIiLCJmaWxlIjoiTG9va3VwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCwgUHJvcFR5cGVzIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgRm9ybUVsZW1lbnQgZnJvbSAnLi9Gb3JtRWxlbWVudCc7XG5pbXBvcnQgSW5wdXQgZnJvbSAnLi9JbnB1dCc7XG5pbXBvcnQgSWNvbiBmcm9tICcuL0ljb24nO1xuaW1wb3J0IFNwaW5uZXIgZnJvbSAnLi9TcGlubmVyJztcbmltcG9ydCBQaWxsIGZyb20gJy4vUGlsbCc7XG5pbXBvcnQgRHJvcGRvd25CdXR0b24gZnJvbSAnLi9Ecm9wZG93bkJ1dHRvbic7XG5pbXBvcnQgeyBEcm9wZG93bk1lbnVJdGVtIH0gZnJvbSAnLi9Ecm9wZG93bk1lbnUnO1xuaW1wb3J0IHsgdXVpZCwgaXNFbEluQ2hpbGRyZW4sIHJlZ2lzdGVyU3R5bGUgfSBmcm9tICcuL3V0aWwnO1xuXG5leHBvcnQgY2xhc3MgTG9va3VwU2VsZWN0aW9uIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgb25LZXlEb3duKGUpIHtcbiAgICBpZiAoZS5rZXlDb2RlID09PSA4IHx8IGUua2V5Q29kZSA9PT0gNDYpIHsgLy8gQmFjc3BhY2UgLyBERUxcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBpZiAodGhpcy5wcm9wcy5vblJlc2V0U2VsZWN0aW9uKSB7XG4gICAgICAgIHRoaXMucHJvcHMub25SZXNldFNlbGVjdGlvbigpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlbmRlclBpbGwoc2VsZWN0ZWQpIHtcbiAgICBjb25zdCBvblBpbGxDbGljayA9IChlKSA9PiB7XG4gICAgICBlLnRhcmdldC5mb2N1cygpO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9O1xuICAgIHJldHVybiAoXG4gICAgICA8UGlsbFxuICAgICAgICBpZD17IHRoaXMucHJvcHMuaWQgfVxuICAgICAgICB0cnVuY2F0ZVxuICAgICAgICBwaWxsUmVmPXsgbm9kZSA9PiAodGhpcy5waWxsID0gbm9kZSkgfVxuICAgICAgICBvbktleURvd249eyB0aGlzLm9uS2V5RG93bi5iaW5kKHRoaXMpIH1cbiAgICAgICAgb25DbGljaz17IG9uUGlsbENsaWNrIH1cbiAgICAgICAgdGFiSW5kZXg9eyAwIH1cbiAgICAgICAgaWNvbj17c2VsZWN0ZWQuaWNvbiA/IHtcbiAgICAgICAgICBjYXRlZ29yeTogc2VsZWN0ZWQuY2F0ZWdvcnksXG4gICAgICAgICAgaWNvbjogc2VsZWN0ZWQuaWNvbixcbiAgICAgICAgfSA6IHVuZGVmaW5lZH1cbiAgICAgICAgbGFiZWw9eyBzZWxlY3RlZC5sYWJlbCB9XG4gICAgICAgIG9uUmVtb3ZlPXsgdGhpcy5wcm9wcy5vblJlc2V0U2VsZWN0aW9uIH1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGhpZGRlbiwgc2VsZWN0ZWQsIGxvb2t1cFNlbGVjdGlvblJlZiB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBsb29rdXBDbGFzc05hbWVzID0gY2xhc3NuYW1lcyhcbiAgICAgIHsgJ3NsZHMtaGlkZSc6IGhpZGRlbiB9XG4gICAgKTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiByZWY9eyBsb29rdXBTZWxlY3Rpb25SZWYgfSBjbGFzc05hbWU9eyBsb29rdXBDbGFzc05hbWVzIH0+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPSdzbGRzLXBpbGxfX2NvbnRhaW5lcic+XG4gICAgICAgICAgeyBzZWxlY3RlZCA/IHRoaXMucmVuZGVyUGlsbChzZWxlY3RlZCkgOiB1bmRlZmluZWQgfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxufVxuXG5jb25zdCBMb29rdXBFbnRyeVR5cGUgPSBQcm9wVHlwZXMuc2hhcGUoe1xuICBjYXRlZ29yeTogUHJvcFR5cGVzLnN0cmluZyxcbiAgaWNvbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgbGFiZWw6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLFxufSk7XG5cbkxvb2t1cFNlbGVjdGlvbi5wcm9wVHlwZXMgPSB7XG4gIGlkOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBzZWxlY3RlZDogTG9va3VwRW50cnlUeXBlLFxuICBoaWRkZW46IFByb3BUeXBlcy5ib29sLFxuICBvblJlc2V0U2VsZWN0aW9uOiBQcm9wVHlwZXMuZnVuYyxcbiAgbG9va3VwU2VsZWN0aW9uUmVmOiBQcm9wVHlwZXMuZnVuYyxcbn07XG5cblxuLyoqXG4gKlxuICovXG5leHBvcnQgY2xhc3MgTG9va3VwU2VhcmNoIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgLyogZXNsaW50LWRpc2FibGUgbWF4LWxlbiAqL1xuICAgIHJlZ2lzdGVyU3R5bGUoJ2xvb2t1cFNlYXJjaCcsIFtcbiAgICAgIFtcbiAgICAgICAgJy5zbGRzLWxvb2t1cFtkYXRhLXNjb3BlPVwibXVsdGlcIl0gLnJlYWN0LXNsZHMtbG9va3VwLXNjb3BlLXNlbGVjdG9yJyxcbiAgICAgICAgJ3sgbWluLXdpZHRoOiAzcmVtOyB9JyxcbiAgICAgIF0sXG4gICAgICBbXG4gICAgICAgICcuc2xkcy1sb29rdXBbZGF0YS1zY29wZT1cIm11bHRpXCJdIC5yZWFjdC1zbGRzLWxvb2t1cC1zY29wZS1zZWxlY3RvciAuc2xkcy1kcm9wZG93bi10cmlnZ2VyJyxcbiAgICAgICAgJ3sgbWFyZ2luLWxlZnQ6IDA7IH0nLFxuICAgICAgXSxcbiAgICAgIFtcbiAgICAgICAgJy5zbGRzLWxvb2t1cFtkYXRhLXNjb3BlPVwibXVsdGlcIl0gLnJlYWN0LXNsZHMtbG9va3VwLXNjb3BlLXNlbGVjdG9yIC5zbGRzLWRyb3Bkb3duLXRyaWdnZXIgLnNsZHMtYnV0dG9uJyxcbiAgICAgICAgJ3sgcGFkZGluZzogMCAwLjI1cmVtOyB9JyxcbiAgICAgIF0sXG4gICAgICBbXG4gICAgICAgICcuc2xkcy1sb29rdXBbZGF0YS1zY29wZT1cIm11bHRpXCJdIC5zbGRzLWJveC0tYm9yZGVyJyxcbiAgICAgICAgJ3sgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7IH0nLFxuICAgICAgXSxcbiAgICAgIFtcbiAgICAgICAgJy5zbGRzLWxvb2t1cFtkYXRhLXNjb3BlPVwibXVsdGlcIl0gLnNsZHMtYm94LS1ib3JkZXIucmVhY3Qtc2xkcy1ib3gtZGlzYWJsZWQnLFxuICAgICAgICAneyBiYWNrZ3JvdW5kLWNvbG9yOiAjZTBlNWVlOyBib3JkZXItY29sb3I6ICNhOGI3Yzc7IGN1cnNvcjogbm90LWFsbG93ZWQ7IH0nLFxuICAgICAgXSxcbiAgICAgIFtcbiAgICAgICAgJy5zbGRzLWxvb2t1cFtkYXRhLXNjb3BlPVwibXVsdGlcIl0gLnNsZHMtYm94LS1ib3JkZXIgLnNsZHMtaW5wdXQtLWJhcmUnLFxuICAgICAgICAneyBoZWlnaHQ6IDIuMTVyZW07IHdpZHRoOiAxMDAlOyB9JyxcbiAgICAgIF0sXG4gICAgXSk7XG4gIH1cblxuICBvbkxvb2t1cEljb25DbGljayA9ICgpID0+IHtcbiAgICB0aGlzLnByb3BzLm9uU3VibWl0KCk7XG4gIH1cblxuICBvbklucHV0S2V5RG93biA9IChlKSA9PiB7XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHsgLy8gcmV0dXJuIGtleVxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGNvbnN0IHNlYXJjaFRleHQgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgIGlmIChzZWFyY2hUZXh0KSB7XG4gICAgICAgIHRoaXMucHJvcHMub25TdWJtaXQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGlmIG5vIHNlYXJjaCB0ZXh0LCBxdWl0IGxvb2t1cCBzZWFyY2hcbiAgICAgICAgdGhpcy5wcm9wcy5vbkNvbXBsZXRlKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IDQwKSB7IC8vIGRvd24ga2V5XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5wcm9wcy5vblByZXNzRG93bigpO1xuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSAyNykgeyAvLyBFU0NcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAvLyBxdWl0IGxvb2t1cCBzZWFyY2ggKGNhbmNlbClcbiAgICAgIGNvbnN0IGNhbmNlbCA9IHRydWU7XG4gICAgICB0aGlzLnByb3BzLm9uQ29tcGxldGUoY2FuY2VsKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucHJvcHMub25LZXlEb3duKSB7XG4gICAgICB0aGlzLnByb3BzLm9uS2V5RG93bihlKTtcbiAgICB9XG4gIH1cblxuICBvbklucHV0Q2hhbmdlID0gKGUpID0+IHtcbiAgICBjb25zdCBzZWFyY2hUZXh0ID0gZS50YXJnZXQudmFsdWU7XG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZShzZWFyY2hUZXh0KTtcbiAgfVxuXG4gIG9uSW5wdXRCbHVyID0gKGUpID0+IHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICghdGhpcy5pc0ZvY3VzZWRJbkNvbXBvbmVudCgpKSB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uQmx1cikge1xuICAgICAgICAgIHRoaXMucHJvcHMub25CbHVyKGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgMTApO1xuICB9XG5cbiAgb25TY29wZU1lbnVDbGljayA9IChlKSA9PiB7XG4gICAgaWYgKHRoaXMucHJvcHMub25TY29wZU1lbnVDbGljaykge1xuICAgICAgdGhpcy5wcm9wcy5vblNjb3BlTWVudUNsaWNrKGUpO1xuICAgIH1cbiAgfVxuXG4gIG9uTWVudUl0ZW1DbGljayA9IChzY29wZSkgPT4ge1xuICAgIGlmICh0aGlzLnByb3BzLm9uU2NvcGVDaGFuZ2UpIHtcbiAgICAgIHRoaXMucHJvcHMub25TY29wZUNoYW5nZShzY29wZS52YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgaXNGb2N1c2VkSW5Db21wb25lbnQoKSB7XG4gICAgcmV0dXJuIGlzRWxJbkNoaWxkcmVuKHRoaXMubm9kZSwgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCk7XG4gIH1cblxuICBoYW5kbGVMb29rdXBTZWFyY2hSZWYgPSAobm9kZSkgPT4ge1xuICAgIHRoaXMubm9kZSA9IG5vZGU7XG4gICAgY29uc3QgeyBsb29rdXBTZWFyY2hSZWYgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGxvb2t1cFNlYXJjaFJlZikgeyBsb29rdXBTZWFyY2hSZWYobm9kZSk7IH1cbiAgfVxuXG4gIHJlbmRlclNlYXJjaElucHV0KHByb3BzKSB7XG4gICAgY29uc3QgeyBjbGFzc05hbWUsIGhpZGRlbiwgc2VhcmNoVGV4dCwgaWNvbkFsaWduID0gJ3JpZ2h0JyB9ID0gcHJvcHM7XG4gICAgY29uc3Qgc2VhcmNoSW5wdXRDbGFzc05hbWVzID0gY2xhc3NuYW1lcyhcbiAgICAgICdzbGRzLWdyaWQnLFxuICAgICAgJ3NsZHMtaW5wdXQtaGFzLWljb24nLFxuICAgICAgYHNsZHMtaW5wdXQtaGFzLWljb24tLSR7aWNvbkFsaWdufWAsXG4gICAgICB7ICdzbGRzLWhpZGUnOiBoaWRkZW4gfSxcbiAgICAgIGNsYXNzTmFtZVxuICAgICk7XG4gICAgY29uc3QgcHByb3BzID0gT2JqZWN0LmFzc2lnbih7fSwgcHJvcHMpO1xuICAgIGRlbGV0ZSBwcHJvcHMuaWNvbkFsaWduO1xuICAgIGRlbGV0ZSBwcHJvcHMuc2VhcmNoVGV4dDtcbiAgICBkZWxldGUgcHByb3BzLnRhcmdldFNjb3BlO1xuICAgIGRlbGV0ZSBwcHJvcHMub25TY29wZU1lbnVDbGljaztcbiAgICBkZWxldGUgcHByb3BzLm9uU2NvcGVDaGFuZ2U7XG4gICAgZGVsZXRlIHBwcm9wcy5vblByZXNzRG93bjtcbiAgICBkZWxldGUgcHByb3BzLm9uQ29tcGxldGU7XG4gICAgZGVsZXRlIHBwcm9wcy5kZWZhdWx0VGFyZ2V0U2NvcGU7XG4gICAgZGVsZXRlIHBwcm9wcy5vblNlYXJjaFRleHRDaGFuZ2U7XG4gICAgZGVsZXRlIHBwcm9wcy5zY29wZXM7XG4gICAgZGVsZXRlIHBwcm9wcy5vbkxvb2t1cFJlcXVlc3Q7XG4gICAgZGVsZXRlIHBwcm9wcy5kZWZhdWx0U2VhcmNoVGV4dDtcbiAgICBkZWxldGUgcHByb3BzLm9uVmFsdWVDaGFuZ2U7XG4gICAgZGVsZXRlIHBwcm9wcy5sb29rdXBTZWFyY2hSZWY7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgcmVmPXsgdGhpcy5oYW5kbGVMb29rdXBTZWFyY2hSZWYgfSBjbGFzc05hbWU9eyBzZWFyY2hJbnB1dENsYXNzTmFtZXMgfT5cbiAgICAgICAgPElucHV0XG4gICAgICAgICAgeyAuLi5wcHJvcHMgfVxuICAgICAgICAgIGlucHV0UmVmPXsgbm9kZSA9PiAodGhpcy5pbnB1dCA9IG5vZGUpIH1cbiAgICAgICAgICB2YWx1ZT17IHNlYXJjaFRleHQgfVxuICAgICAgICAgIG9uS2V5RG93bj17IHRoaXMub25JbnB1dEtleURvd24gfVxuICAgICAgICAgIG9uQ2hhbmdlPXsgdGhpcy5vbklucHV0Q2hhbmdlIH1cbiAgICAgICAgICBvbkJsdXI9eyB0aGlzLm9uSW5wdXRCbHVyIH1cbiAgICAgICAgLz5cbiAgICAgICAgPHNwYW5cbiAgICAgICAgICB0YWJJbmRleD17IC0xIH1cbiAgICAgICAgICBzdHlsZT17IHByb3BzLmRpc2FibGVkID8gdW5kZWZpbmVkIDogeyBjdXJzb3I6ICdwb2ludGVyJyB9IH1cbiAgICAgICAgICBvbkNsaWNrPXsgcHJvcHMuZGlzYWJsZWQgPyB1bmRlZmluZWQgOiB0aGlzLm9uTG9va3VwSWNvbkNsaWNrIH1cbiAgICAgICAgPlxuICAgICAgICAgIDxJY29uXG4gICAgICAgICAgICBpY29uPSdzZWFyY2gnXG4gICAgICAgICAgICBjbGFzc05hbWU9J3NsZHMtaW5wdXRfX2ljb24nXG4gICAgICAgICAgLz5cbiAgICAgICAgPC9zcGFuPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlclNjb3BlU2VsZWN0b3IoeyBzY29wZXMsIHRhcmdldFNjb3BlOiB0YXJnZXQsIGRpc2FibGVkIH0pIHtcbiAgICBsZXQgdGFyZ2V0U2NvcGUgPSBzY29wZXNbMF0gfHwge307XG4gICAgZm9yIChjb25zdCBzY29wZSBvZiBzY29wZXMpIHtcbiAgICAgIGlmIChzY29wZS52YWx1ZSA9PT0gdGFyZ2V0KSB7XG4gICAgICAgIHRhcmdldFNjb3BlID0gc2NvcGU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBpY29uID0gPEljb24gaWNvbj17IHRhcmdldFNjb3BlLmljb24gfHwgJ25vbmUnIH0gc2l6ZT0neC1zbWFsbCcgLz47XG4gICAgY29uc3Qgc2VsZWN0b3JDbGFzc05hbWVzID0gY2xhc3NuYW1lcyhcbiAgICAgICdzbGRzLWdyaWQnLFxuICAgICAgJ3NsZHMtZ3JpZC0tYWxpZ24tY2VudGVyJyxcbiAgICAgICdzbGRzLWdyaWQtLXZlcnRpY2FsLWFsaWduLWNlbnRlcicsXG4gICAgICAncmVhY3Qtc2xkcy1sb29rdXAtc2NvcGUtc2VsZWN0b3InXG4gICAgKTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9eyBzZWxlY3RvckNsYXNzTmFtZXMgfT5cbiAgICAgICAgPERyb3Bkb3duQnV0dG9uXG4gICAgICAgICAgbGFiZWw9eyBpY29uIH1cbiAgICAgICAgICBkaXNhYmxlZD17IGRpc2FibGVkIH1cbiAgICAgICAgICBvbkNsaWNrPXsgdGhpcy5vblNjb3BlTWVudUNsaWNrIH1cbiAgICAgICAgICBvbk1lbnVJdGVtQ2xpY2s9eyB0aGlzLm9uTWVudUl0ZW1DbGljayB9XG4gICAgICAgICAgb25CbHVyPXsgdGhpcy5vbklucHV0Qmx1ciB9XG4gICAgICAgID5cbiAgICAgICAgICB7IHNjb3Blcy5tYXAoc2NvcGUgPT4gPERyb3Bkb3duTWVudUl0ZW0ga2V5PXsgc2NvcGUudmFsdWUgfSB7IC4uLnNjb3BlIH0gLz4pIH1cbiAgICAgICAgPC9Ecm9wZG93bkJ1dHRvbj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBzY29wZXMsIGhpZGRlbiwgZGlzYWJsZWQsIHRhcmdldFNjb3BlLCAuLi5wcm9wcyB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoc2NvcGVzKSB7XG4gICAgICBjb25zdCBsb29rdXBTZWFyY2hDbGFzc05hbWVzID0gY2xhc3NuYW1lcyhcbiAgICAgICAgJ3NsZHMtZ3JpZCcsXG4gICAgICAgICdzbGRzLWZvcm0tZWxlbWVudF9fY29udHJvbCcsXG4gICAgICAgICdzbGRzLWJveC0tYm9yZGVyJyxcbiAgICAgICAgeyAncmVhY3Qtc2xkcy1ib3gtZGlzYWJsZWQnOiBkaXNhYmxlZCB9LFxuICAgICAgICB7ICdzbGRzLWhpZGUnOiBoaWRkZW4gfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHN0eWxlcyA9IHsgV2Via2l0RmxleFdyYXA6ICdub3dyYXAnLCBtc0ZsZXhXcmFwOiAnbm93cmFwJywgZmxleFdyYXA6ICdub3dyYXAnIH07XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IHJlZj17IHRoaXMuaGFuZGxlTG9va3VwU2VhcmNoUmVmIH0gY2xhc3NOYW1lPXsgbG9va3VwU2VhcmNoQ2xhc3NOYW1lcyB9IHN0eWxlPXsgc3R5bGVzIH0+XG4gICAgICAgICAgeyB0aGlzLnJlbmRlclNjb3BlU2VsZWN0b3IoeyBzY29wZXMsIHRhcmdldFNjb3BlLCBkaXNhYmxlZCB9KSB9XG4gICAgICAgICAgeyB0aGlzLnJlbmRlclNlYXJjaElucHV0KHsgLi4ucHJvcHMsIGRpc2FibGVkLCBjbGFzc05hbWU6ICdzbGRzLWNvbCcsIGJhcmU6IHRydWUgfSkgfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnJlbmRlclNlYXJjaElucHV0KHRoaXMucHJvcHMpO1xuICB9XG5cbn1cblxuY29uc3QgSUNPTl9BTElHTlMgPSBbJ2xlZnQnLCAncmlnaHQnXTtcblxuTG9va3VwU2VhcmNoLnByb3BUeXBlcyA9IHtcbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBoaWRkZW46IFByb3BUeXBlcy5ib29sLFxuICBzZWFyY2hUZXh0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICBzY29wZXM6IFByb3BUeXBlcy5hcnJheU9mKFxuICAgIFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICBsYWJlbDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgaWNvbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgICB9KVxuICApLFxuICB0YXJnZXRTY29wZTogUHJvcFR5cGVzLmFueSwgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBpY29uQWxpZ246IFByb3BUeXBlcy5vbmVPZihJQ09OX0FMSUdOUyksXG4gIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgb25LZXlEb3duOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25CbHVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICBvblNjb3BlTWVudUNsaWNrOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25TY29wZUNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uUHJlc3NEb3duOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25TdWJtaXQ6IFByb3BUeXBlcy5mdW5jLFxuICBvbkNvbXBsZXRlOiBQcm9wVHlwZXMuZnVuYyxcbiAgbG9va3VwU2VhcmNoUmVmOiBQcm9wVHlwZXMuZnVuYyxcbn07XG5cbi8qKlxuICpcbiAqL1xuZXhwb3J0IGNsYXNzIExvb2t1cENhbmRpZGF0ZUxpc3QgZXh0ZW5kcyBDb21wb25lbnQge1xuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIGlmICh0aGlzLnByb3BzLmZvY3VzKSB7XG4gICAgICB0aGlzLmZvY3VzVG9UYXJnZXRJdGVtRWwoMCk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgIGlmICh0aGlzLnByb3BzLmZvY3VzICYmICFwcmV2UHJvcHMuZm9jdXMpIHtcbiAgICAgIHRoaXMuZm9jdXNUb1RhcmdldEl0ZW1FbCgwKTtcbiAgICB9XG4gIH1cblxuICBvblNlbGVjdChlbnRyeSkge1xuICAgIGlmICh0aGlzLnByb3BzLm9uU2VsZWN0KSB7XG4gICAgICB0aGlzLnByb3BzLm9uU2VsZWN0KGVudHJ5KTtcbiAgICB9XG4gIH1cblxuICBvbktleURvd24oZSkge1xuICAgIGlmIChlLmtleUNvZGUgPT09IDM4IHx8IGUua2V5Q29kZSA9PT0gNDApIHsgLy8gVVAvRE9XTlxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRFbCA9IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQ7XG4gICAgICBsZXQgaXRlbUVsID0gZS5rZXlDb2RlID09PSA0MCA/IGN1cnJlbnRFbC5uZXh0U2libGluZyA6IGN1cnJlbnRFbC5wcmV2aW91c1NpYmxpbmc7XG4gICAgICB3aGlsZSAoaXRlbUVsKSB7XG4gICAgICAgIGNvbnN0IGFuY2hvckVsID0gaXRlbUVsLnF1ZXJ5U2VsZWN0b3IoJy5yZWFjdC1zbGRzLWNhbmRpZGF0ZVt0YWJJbmRleF0nKTtcbiAgICAgICAgaWYgKGFuY2hvckVsICYmICFhbmNob3JFbC5kaXNhYmxlZCkge1xuICAgICAgICAgIGFuY2hvckVsLmZvY3VzKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGl0ZW1FbCA9IGUua2V5Q29kZSA9PT0gNDAgPyBpdGVtRWwubmV4dFNpYmxpbmcgOiBpdGVtRWwucHJldmlvdXNTaWJsaW5nO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSAyNykgeyAvLyBFU0NcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLm9uU2VsZWN0KG51bGwpO1xuICAgIH1cbiAgfVxuXG4gIGZvY3VzVG9UYXJnZXRJdGVtRWwoaW5kZXgpIHtcbiAgICBjb25zdCBlbCA9IHRoaXMubm9kZTtcbiAgICBjb25zdCBhbmNob3JzID0gZWwucXVlcnlTZWxlY3RvckFsbCgnLnJlYWN0LXNsZHMtY2FuZGlkYXRlW3RhYkluZGV4XScpO1xuICAgIGlmIChhbmNob3JzW2luZGV4XSkge1xuICAgICAgYW5jaG9yc1tpbmRleF0uZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICByZW5kZXJDYW5kaWRhdGUoZW50cnkpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGxpIGNsYXNzTmFtZT0nc2xkcy1sb29rdXBfX2l0ZW0nIGtleT17IGVudHJ5LnZhbHVlIH0+XG4gICAgICAgIDxhXG4gICAgICAgICAgY2xhc3NOYW1lPSdzbGRzLXRydW5jYXRlIHJlYWN0LXNsZHMtY2FuZGlkYXRlJ1xuICAgICAgICAgIHRhYkluZGV4PXsgLTEgfVxuICAgICAgICAgIHJvbGU9J29wdGlvbidcbiAgICAgICAgICBvbktleURvd249eyBlID0+IGUua2V5Q29kZSA9PT0gMTMgJiYgdGhpcy5vblNlbGVjdChlbnRyeSkgfVxuICAgICAgICAgIG9uQmx1cj17IHRoaXMucHJvcHMub25CbHVyIH1cbiAgICAgICAgICBvbkNsaWNrPXsgKCkgPT4gdGhpcy5vblNlbGVjdChlbnRyeSkgfVxuICAgICAgICA+XG4gICAgICAgICAge1xuICAgICAgICAgICAgZW50cnkuaWNvbiA/XG4gICAgICAgICAgICAgIDxJY29uXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnk9eyBlbnRyeS5jYXRlZ29yeSB9XG4gICAgICAgICAgICAgICAgaWNvbj17IGVudHJ5Lmljb24gfVxuICAgICAgICAgICAgICAgIHNpemU9J3NtYWxsJ1xuICAgICAgICAgICAgICAvPiA6XG4gICAgICAgICAgICAgIHVuZGVmaW5lZFxuICAgICAgICAgIH1cbiAgICAgICAgICB7IGVudHJ5LmxhYmVsIH1cbiAgICAgICAgPC9hPlxuICAgICAgPC9saT5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgZGF0YSA9IFtdLCBoaWRkZW4sIGxvYWRpbmcsIGhlYWRlciwgZm9vdGVyLCBmaWx0ZXIgPSAoKSA9PiB0cnVlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGxvb2t1cE1lbnVDbGFzc05hbWVzID0gY2xhc3NuYW1lcyhcbiAgICAgICdzbGRzLWxvb2t1cF9fbWVudScsXG4gICAgICB7ICdzbGRzLWhpZGUnOiBoaWRkZW4sICdzbGRzLXNob3cnOiAhaGlkZGVuIH1cbiAgICApO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIHJlZj17IG5vZGUgPT4gKHRoaXMubm9kZSA9IG5vZGUpIH1cbiAgICAgICAgY2xhc3NOYW1lPXsgbG9va3VwTWVudUNsYXNzTmFtZXMgfVxuICAgICAgICByb2xlPSdsaXN0Ym94J1xuICAgICAgICBvbktleURvd249eyB0aGlzLm9uS2V5RG93bi5iaW5kKHRoaXMpIH1cbiAgICAgID5cbiAgICAgICAge1xuICAgICAgICAgIGhlYWRlciA/XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nc2xkcy1sb29rdXBfX2l0ZW0nPnsgaGVhZGVyIH08L2Rpdj4gOlxuICAgICAgICAgICAgdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgICAgPHVsIGNsYXNzTmFtZT0nc2xkcy1sb29rdXBfX2xpc3QnIHJvbGU9J3ByZXNlbnRhdGlvbic+XG4gICAgICAgICAge1xuICAgICAgICAgICAgZGF0YS5maWx0ZXIoZmlsdGVyKS5tYXAodGhpcy5yZW5kZXJDYW5kaWRhdGUuYmluZCh0aGlzKSlcbiAgICAgICAgICB9XG4gICAgICAgICAge1xuICAgICAgICAgICAgbG9hZGluZyA/XG4gICAgICAgICAgICAgIDxsaSBjbGFzc05hbWU9J3NsZHMtbG9va3VwX19pdGVtJyBrZXk9J2xvYWRpbmcnIHN0eWxlPXsgeyBoZWlnaHQ6IDIwIH0gfT5cbiAgICAgICAgICAgICAgICA8U3Bpbm5lciBjb250YWluZXI9e2ZhbHNlfSBzaXplPSdzbWFsbCcgc3R5bGU9eyB7IG1hcmdpbjogJzAgYXV0bycgfSB9IC8+XG4gICAgICAgICAgICAgIDwvbGk+IDpcbiAgICAgICAgICAgICAgdW5kZWZpbmVkXG4gICAgICAgICAgfVxuICAgICAgICA8L3VsPlxuICAgICAgICB7XG4gICAgICAgICAgZm9vdGVyID9cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdzbGRzLWxvb2t1cF9faXRlbSc+eyBmb290ZXIgfTwvZGl2PiA6XG4gICAgICAgICAgICB1bmRlZmluZWRcbiAgICAgICAgfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG59XG5cbkxvb2t1cENhbmRpZGF0ZUxpc3QucHJvcFR5cGVzID0ge1xuICBkYXRhOiBQcm9wVHlwZXMuYXJyYXlPZihMb29rdXBFbnRyeVR5cGUpLFxuICBmb2N1czogUHJvcFR5cGVzLmJvb2wsXG4gIGxvYWRpbmc6IFByb3BUeXBlcy5ib29sLFxuICBoaWRkZW46IFByb3BUeXBlcy5ib29sLFxuICBmaWx0ZXI6IFByb3BUeXBlcy5mdW5jLFxuICBvblNlbGVjdDogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uQmx1cjogUHJvcFR5cGVzLmZ1bmMsXG4gIGhlYWRlcjogUHJvcFR5cGVzLm5vZGUsXG4gIGZvb3RlcjogUHJvcFR5cGVzLm5vZGUsXG59O1xuXG5cbi8qKlxuICpcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9va3VwIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGlkOiBgZm9ybS1lbGVtZW50LSR7dXVpZCgpfWAsXG4gICAgICBzZWxlY3RlZDogcHJvcHMuZGVmYXVsdFNlbGVjdGVkLFxuICAgICAgb3BlbmVkOiBwcm9wcy5kZWZhdWx0T3BlbmVkLFxuICAgICAgc2VhcmNoVGV4dDogcHJvcHMuZGVmYXVsdFNlYXJjaFRleHQsXG4gICAgICB0YXJnZXRTY29wZTogcHJvcHMuZGVmYXVsdFRhcmdldFNjb3BlLFxuICAgICAgZm9jdXNGaXJzdENhbmRpZGF0ZTogZmFsc2UsXG4gICAgfTtcbiAgfVxuXG4gIG9uU2NvcGVNZW51Q2xpY2soZSkge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBvcGVuZWQ6IGZhbHNlIH0pO1xuICAgIGlmICh0aGlzLnByb3BzLm9uU2NvcGVNZW51Q2xpY2spIHtcbiAgICAgIHRoaXMucHJvcHMub25TY29wZU1lbnVDbGljayhlKTtcbiAgICB9XG4gIH1cblxuICBvblNjb3BlQ2hhbmdlKHRhcmdldFNjb3BlKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHRhcmdldFNjb3BlIH0pO1xuICAgIGlmICh0aGlzLnByb3BzLm9uU2NvcGVDaGFuZ2UpIHtcbiAgICAgIHRoaXMucHJvcHMub25TY29wZUNoYW5nZSh0YXJnZXRTY29wZSk7XG4gICAgfVxuICB9XG5cbiAgb25TZWFyY2hUZXh0Q2hhbmdlKHNlYXJjaFRleHQpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgc2VhcmNoVGV4dCB9KTtcbiAgICBpZiAodGhpcy5wcm9wcy5vblNlYXJjaFRleHRDaGFuZ2UpIHtcbiAgICAgIHRoaXMucHJvcHMub25TZWFyY2hUZXh0Q2hhbmdlKHNlYXJjaFRleHQpO1xuICAgIH1cbiAgfVxuXG4gIG9uTG9va3VwUmVxdWVzdChzZWFyY2hUZXh0KSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IG9wZW5lZDogdHJ1ZSB9KTtcbiAgICBpZiAodGhpcy5wcm9wcy5vbkxvb2t1cFJlcXVlc3QpIHtcbiAgICAgIHRoaXMucHJvcHMub25Mb29rdXBSZXF1ZXN0KHNlYXJjaFRleHQpO1xuICAgIH1cbiAgfVxuXG4gIG9uUmVzZXRTZWxlY3Rpb24oKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGVkOiBudWxsIH0pO1xuICAgIGlmICh0aGlzLnByb3BzLm9uU2VsZWN0KSB7XG4gICAgICB0aGlzLnByb3BzLm9uU2VsZWN0KG51bGwpO1xuICAgIH1cbiAgICB0aGlzLm9uU2VhcmNoVGV4dENoYW5nZSgnJyk7XG4gICAgdGhpcy5vbkxvb2t1cFJlcXVlc3QoJycpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3Qgc2VhcmNoRWxlbSA9IHRoaXMuc2VhcmNoO1xuICAgICAgY29uc3QgaW5wdXRFbGVtID0gc2VhcmNoRWxlbS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgICAgaW5wdXRFbGVtLmZvY3VzKCk7XG4gICAgfSwgMTApO1xuICB9XG5cbiAgb25Mb29rdXBJdGVtU2VsZWN0KHNlbGVjdGVkKSB7XG4gICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgc2VsZWN0ZWQsIG9wZW5lZDogZmFsc2UgfSk7XG4gICAgICBpZiAodGhpcy5wcm9wcy5vblNlbGVjdCkge1xuICAgICAgICB0aGlzLnByb3BzLm9uU2VsZWN0KHNlbGVjdGVkKTtcbiAgICAgIH1cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25FbGVtID0gdGhpcy5zZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IHBpbGxFbGVtID0gc2VsZWN0aW9uRWxlbS5xdWVyeVNlbGVjdG9yKCdhJyk7XG4gICAgICAgIGlmIChwaWxsRWxlbSkgeyBwaWxsRWxlbS5mb2N1cygpOyB9XG4gICAgICB9LCAxMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBvcGVuZWQ6IGZhbHNlIH0pO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNlYXJjaEVsZW0gPSB0aGlzLnNlYXJjaDtcbiAgICAgICAgY29uc3QgaW5wdXRFbGVtID0gc2VhcmNoRWxlbS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgICAgICBpbnB1dEVsZW0uZm9jdXMoKTtcbiAgICAgIH0sIDEwKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucHJvcHMub25Db21wbGV0ZSkge1xuICAgICAgdGhpcy5wcm9wcy5vbkNvbXBsZXRlKCk7IC8vIHRlbGwgdGhlIGNvbXBvbmVudCBjb250YWluZXIgdG8gcXVpdCBsb29rdXBcbiAgICB9XG4gIH1cblxuICBvbkZvY3VzRmlyc3RDYW5kaWRhdGUoKSB7XG4gICAgY29uc3QgeyBvcGVuZWQgPSB0aGlzLnN0YXRlLm9wZW5lZCB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoIW9wZW5lZCkge1xuICAgICAgdGhpcy5vbkxvb2t1cFJlcXVlc3QodGhpcy5zdGF0ZS5zZWFyY2hUZXh0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGZvY3VzRmlyc3RDYW5kaWRhdGU6IHRydWUgfSk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGZvY3VzRmlyc3RDYW5kaWRhdGU6IGZhbHNlIH0pO1xuICAgICAgfSwgMTApO1xuICAgIH1cbiAgfVxuXG4gIG9uQmx1cigpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICghdGhpcy5pc0ZvY3VzZWRJbkNvbXBvbmVudCgpKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBvcGVuZWQ6IGZhbHNlIH0pO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5vbkJsdXIpIHtcbiAgICAgICAgICB0aGlzLnByb3BzLm9uQmx1cigpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uQ29tcGxldGUpIHtcbiAgICAgICAgICB0aGlzLnByb3BzLm9uQ29tcGxldGUodHJ1ZSk7IC8vIHF1aXQgbG9va3VwIChjYW5jZWwpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCAxMCk7XG4gIH1cblxuICBpc0ZvY3VzZWRJbkNvbXBvbmVudCgpIHtcbiAgICBjb25zdCByb290RWwgPSB0aGlzLm5vZGU7XG4gICAgbGV0IHRhcmdldEVsID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICB3aGlsZSAodGFyZ2V0RWwgJiYgdGFyZ2V0RWwgIT09IHJvb3RFbCkge1xuICAgICAgdGFyZ2V0RWwgPSB0YXJnZXRFbC5wYXJlbnROb2RlO1xuICAgIH1cbiAgICByZXR1cm4gISF0YXJnZXRFbDtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBpZCA9IHRoaXMucHJvcHMuaWQgfHwgdGhpcy5zdGF0ZS5pZDtcbiAgICBjb25zdCB7XG4gICAgICB0b3RhbENvbHMsIGNvbHMsXG4gICAgICBsYWJlbCwgcmVxdWlyZWQsIGVycm9yLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgc2VsZWN0ZWQgPSB0aGlzLnN0YXRlLnNlbGVjdGVkLFxuICAgICAgb3BlbmVkID0gdGhpcy5zdGF0ZS5vcGVuZWQsXG4gICAgICBzZWFyY2hUZXh0ID0gdGhpcy5zdGF0ZS5zZWFyY2hUZXh0LFxuICAgICAgdGFyZ2V0U2NvcGUgPSB0aGlzLnN0YXRlLnRhcmdldFNjb3BlLFxuICAgICAgbG9hZGluZywgbG9va3VwRmlsdGVyLFxuICAgICAgbGlzdEhlYWRlciwgbGlzdEZvb3RlcixcbiAgICAgIGRhdGEsXG4gICAgICBvbkNvbXBsZXRlLFxuICAgICAgLi4ucHJvcHNcbiAgICB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBkcm9wZG93biA9IChcbiAgICAgIDxMb29rdXBDYW5kaWRhdGVMaXN0XG4gICAgICAgIHJlZj17IG5vZGUgPT4gKHRoaXMuY2FuZGlkYXRlTGlzdCA9IG5vZGUpIH1cbiAgICAgICAgZGF0YT17IGRhdGEgfVxuICAgICAgICBmb2N1cz17IHRoaXMuc3RhdGUuZm9jdXNGaXJzdENhbmRpZGF0ZSB9XG4gICAgICAgIGhpZGRlbj17ICFvcGVuZWQgfVxuICAgICAgICBsb2FkaW5nPXsgbG9hZGluZyB9XG4gICAgICAgIGZpbHRlcj17IGxvb2t1cEZpbHRlciA/IGVudHJ5ID0+IGxvb2t1cEZpbHRlcihlbnRyeSwgc2VhcmNoVGV4dCwgdGFyZ2V0U2NvcGUpIDogdW5kZWZpbmVkIH1cbiAgICAgICAgaGVhZGVyPXsgbGlzdEhlYWRlciB9XG4gICAgICAgIGZvb3Rlcj17IGxpc3RGb290ZXIgfVxuICAgICAgICBvblNlbGVjdD17IHRoaXMub25Mb29rdXBJdGVtU2VsZWN0LmJpbmQodGhpcykgfVxuICAgICAgICBvbkJsdXI9eyB0aGlzLm9uQmx1ci5iaW5kKHRoaXMpIH1cbiAgICAgIC8+XG4gICAgKTtcbiAgICBjb25zdCBsb29rdXBDbGFzc05hbWVzID0gY2xhc3NuYW1lcyhcbiAgICAgICdzbGRzLWxvb2t1cCcsXG4gICAgICB7ICdzbGRzLWhhcy1zZWxlY3Rpb24nOiBzZWxlY3RlZCB9LFxuICAgICAgY2xhc3NOYW1lXG4gICAgKTtcbiAgICBjb25zdCBmb3JtRWxlbVByb3BzID0geyBpZCwgdG90YWxDb2xzLCBjb2xzLCBsYWJlbCwgcmVxdWlyZWQsIGVycm9yLCBkcm9wZG93biB9O1xuICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovXG4gICAgY29uc3Qge1xuICAgICAgZGVmYXVsdFNlbGVjdGVkLCBkZWZhdWx0T3BlbmVkLCBkZWZhdWx0U2VhcmNoVGV4dCwgZGVmYXVsdFRhcmdldFNjb3BlLFxuICAgICAgb25TZWxlY3QsIG9uQmx1ciwgb25TY29wZUNoYW5nZSwgb25TY29wZU1lbnVDbGljaywgb25TZWFyY2hUZXh0Q2hhbmdlLCBvbkxvb2t1cFJlcXVlc3QsXG4gICAgICAuLi5zZWFyY2hQcm9wc1xuICAgIH0gPSBwcm9wcztcbiAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXVudXNlZC12YXJzICovXG4gICAgcmV0dXJuIChcbiAgICAgIDxGb3JtRWxlbWVudCBmb3JtRWxlbWVudFJlZj17IG5vZGUgPT4gKHRoaXMubm9kZSA9IG5vZGUpIH0geyAuLi5mb3JtRWxlbVByb3BzIH0+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzc05hbWU9eyBsb29rdXBDbGFzc05hbWVzIH1cbiAgICAgICAgICBkYXRhLXNlbGVjdD0nc2luZ2xlJ1xuICAgICAgICAgIGRhdGEtc2NvcGU9eyBwcm9wcy5zY29wZXMgPyAnbXVsdGknIDogJ3NpbmdsZScgfVxuICAgICAgICAgIGRhdGEtdHlwZWFoZWFkPXsgZmFsc2UgfVxuICAgICAgICA+XG4gICAgICAgICAge1xuICAgICAgICAgICAgc2VsZWN0ZWQgP1xuICAgICAgICAgICAgICA8TG9va3VwU2VsZWN0aW9uXG4gICAgICAgICAgICAgICAgaWQ9eyBpZCB9XG4gICAgICAgICAgICAgICAgbG9va3VwU2VsZWN0aW9uUmVmPXsgbm9kZSA9PiAodGhpcy5zZWxlY3Rpb24gPSBub2RlKSB9XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ9eyBzZWxlY3RlZCB9XG4gICAgICAgICAgICAgICAgb25SZXNldFNlbGVjdGlvbj17IHRoaXMub25SZXNldFNlbGVjdGlvbi5iaW5kKHRoaXMpIH1cbiAgICAgICAgICAgICAgLz4gOlxuICAgICAgICAgICAgICAgIDxMb29rdXBTZWFyY2hcbiAgICAgICAgICAgICAgICAgIHsgLi4uc2VhcmNoUHJvcHMgfVxuICAgICAgICAgICAgICAgICAgaWQ9eyBpZCB9XG4gICAgICAgICAgICAgICAgICBsb29rdXBTZWFyY2hSZWY9eyBub2RlID0+ICh0aGlzLnNlYXJjaCA9IG5vZGUpIH1cbiAgICAgICAgICAgICAgICAgIHNlYXJjaFRleHQ9eyBzZWFyY2hUZXh0IH1cbiAgICAgICAgICAgICAgICAgIHRhcmdldFNjb3BlPXsgdGFyZ2V0U2NvcGUgfVxuICAgICAgICAgICAgICAgICAgb25TY29wZU1lbnVDbGljaz17IHRoaXMub25TY29wZU1lbnVDbGljay5iaW5kKHRoaXMpIH1cbiAgICAgICAgICAgICAgICAgIG9uU2NvcGVDaGFuZ2U9eyB0aGlzLm9uU2NvcGVDaGFuZ2UuYmluZCh0aGlzKSB9XG4gICAgICAgICAgICAgICAgICBvbkNoYW5nZT17IHRoaXMub25TZWFyY2hUZXh0Q2hhbmdlLmJpbmQodGhpcykgfVxuICAgICAgICAgICAgICAgICAgb25TdWJtaXQ9eyAoKSA9PiB0aGlzLm9uTG9va3VwUmVxdWVzdChzZWFyY2hUZXh0KSB9XG4gICAgICAgICAgICAgICAgICBvblByZXNzRG93bj17IHRoaXMub25Gb2N1c0ZpcnN0Q2FuZGlkYXRlLmJpbmQodGhpcykgfVxuICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZT17IG9uQ29tcGxldGUgfVxuICAgICAgICAgICAgICAgICAgb25CbHVyPXsgdGhpcy5vbkJsdXIuYmluZCh0aGlzKSB9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICB9XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9Gb3JtRWxlbWVudD5cbiAgICApO1xuICB9XG59XG5cblxuTG9va3VwLnByb3BUeXBlcyA9IHtcbiAgaWQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgbGFiZWw6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHJlcXVpcmVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgZXJyb3I6IEZvcm1FbGVtZW50LnByb3BUeXBlcy5lcnJvcixcbiAgdmFsdWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGRlZmF1bHRWYWx1ZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgc2VsZWN0ZWQ6IExvb2t1cEVudHJ5VHlwZSxcbiAgZGVmYXVsdFNlbGVjdGVkOiBMb29rdXBFbnRyeVR5cGUsXG4gIG9wZW5lZDogUHJvcFR5cGVzLmJvb2wsXG4gIGRlZmF1bHRPcGVuZWQ6IFByb3BUeXBlcy5ib29sLFxuICBzZWFyY2hUZXh0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICBkZWZhdWx0U2VhcmNoVGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgbG9hZGluZzogUHJvcFR5cGVzLmJvb2wsXG4gIGRhdGE6IFByb3BUeXBlcy5hcnJheU9mKExvb2t1cEVudHJ5VHlwZSksXG4gIGxvb2t1cEZpbHRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gIGxpc3RIZWFkZXI6IFByb3BUeXBlcy5ub2RlLFxuICBsaXN0Rm9vdGVyOiBQcm9wVHlwZXMubm9kZSxcbiAgc2NvcGVzOiBQcm9wVHlwZXMuYXJyYXlPZihcbiAgICBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgbGFiZWw6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICB2YWx1ZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIGljb246IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgfSlcbiAgKSxcbiAgdGFyZ2V0U2NvcGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGljb25BbGlnbjogUHJvcFR5cGVzLm9uZU9mKElDT05fQUxJR05TKSxcbiAgZGVmYXVsdFRhcmdldFNjb3BlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBvblNlYXJjaFRleHRDaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICBvblNjb3BlTWVudUNsaWNrOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25TY29wZUNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uTG9va3VwUmVxdWVzdDogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uQmx1cjogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uU2VsZWN0OiBQcm9wVHlwZXMuZnVuYyxcbiAgb25Db21wbGV0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gIHRvdGFsQ29sczogUHJvcFR5cGVzLm51bWJlcixcbiAgY29sczogUHJvcFR5cGVzLm51bWJlcixcbn07XG5cbkxvb2t1cC5pc0Zvcm1FbGVtZW50ID0gdHJ1ZTtcbiJdfQ==